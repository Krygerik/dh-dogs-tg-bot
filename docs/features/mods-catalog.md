# Каталог модов и выбор модов

## Цель
Через API отдавать список всех доступных модов из `patches/stable`, показывать
их в клиенте Frida (Session Control -> Mods) и передавать выбранные моды при
старте сессии. Сервер должен запускать сессию только с модами из запроса
(без скрытой загрузки конфигов).

## Текущее состояние (база)
- Сервер выбирает скрипты через `frida/loader.py` + конфиги в
  `patches/alllready_configs`.
- Клиент отправляет только `{ mapName }`, сервер сам выбирает набор скриптов.

## Решение
Используем **Вариант A** (единственный):
- Добавить `GET /mods`, который возвращает каталог из `patches/stable`.
- API сканирует `patches/stable` на каждый запрос (TODO: можно добавить кеш).
- Вместе с модами API возвращает готовые сборники из `patches/alllready_configs`.
- Клиент рисует список как чекбоксы (по умолчанию выключены).
- Клиент шлёт массив `mods` при старте (`/run`, `/testing`).
- Сервер валидирует и использует только запрошенные моды для Frida‑инъекции.

## Контракт данных
**GET /mods**
```json
{
  "ok": true,
  "mods": [
    {
      "id": "spellboost",
      "name": "spellboost",
      "scriptPath": "patches/stable/spellboost/spellboost.js",
      "description": "All Thrall spells now heal, except Spirit Walk."
    }
  ],
  "collections": [
    {
      "id": "Departure",
      "name": "Departure",
      "mods": ["spellboost", "randroles"]
    }
  ]
}
```

**POST /run** / **POST /testing**
```json
{
  "mapName": "Departure",
  "mods": ["spellboost", "randroles"]
}
```

## Серверная часть
- Сканировать директории `patches/stable/*/`.
- Для каждой папки читать:
  - `<name>/<name>.js` (путь к скрипту для инъекции)
  - `<name>/<name>.txt` (описание)
- Собрать каталог `{ id, name, scriptPath, description }`.
- Валидировать входящие `mods` (неизвестные ID можно игнорировать или
  отклонять — решение на этапе реализации).
- Преобразовать выбранные ID в пути скриптов.
- Сканировать `patches/alllready_configs/*` и собирать коллекции:
  - `id`/`name` берём из имени файла (без расширения).
  - `mods` — это имена модов (basename папок) из `patches/stable`, на которые
    указывают строки внутри конфигов.

## Frida loader
Передавать явный список скриптов в loader вместо map‑конфигов.
Выбранный подход: **передавать JSON‑список** через аргументы
`--mods-json` (без временных файлов).

## Клиентский UI
- Добавить разворачиваемую секцию "Mods" в Session Control.
- Показать список модов с описанием (чекбоксы выключены).
- При "Start session" отправлять выбранные ID в теле запроса.
- TODO: добавить компактный бейдж с выбранными модами под кнопкой запуска.
- Добавить переключаемые кнопки для сборников на одном уровне с
  "Select all" / "Clear".
- Поведение кнопок сборников:
  - **Обычная** — готова к использованию.
  - **Выбранная** — активирована, все моды из сборника выбраны.
  - Повторное нажатие на выбранную кнопку снимает выбор модов сборника.
  - При ручном выборе/снятии модов проверять, соответствует ли набор
    какому‑то сборнику: если да — подсветить соответствующую кнопку.
- В свернутом состоянии секции Mods показывать плашки активных сборников.
- Если выбраны моды вне активных сборников — показывать плашку "+ others".

## Совместимость
- Если `mods` отсутствует или пуст: запуск возможен без модов.
- `alllready_configs` остаётся в проекте для будущих наработок, но новый флоу
  их не использует.
